<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <title>Kiểm tra vị trí trước khi truy cập Form</title>
</head>
<body>
<h2>Đang kiểm tra vị trí...</h2>
<div id='result'></div>

<script>
// Tọa độ trung tâm
const centerLat = 15.573; // Vĩ độ trung tâm
const centerLon = 108.474; // Kinh độ trung tâm
const radius = 700; // Bán kính cho phép (mét)
const redirectUrl = 'https://forms.office.com/e/VTdiDmu13x?origin=lprLink';

// Hàm tính khoảng cách giữa hai điểm theo công thức Haversine
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371000; // Bán kính Trái Đất (m)
  const toRad = deg => deg * Math.PI / 180;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// Lấy vị trí người dùng
navigator.geolocation.getCurrentPosition(pos => {
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;
  const distance = haversine(centerLat, centerLon, lat, lon);
  if (distance <= radius) {
    document.getElementById('result').innerHTML = '<h3>✅ Trong phạm vi cho phép! Đang chuyển hướng...</h3>';
    setTimeout(() => { window.location.href = redirectUrl; }, 2000);
  } else {
    document.getElementById('result').innerHTML = '<h3>❌ Ngoài phạm vi 700m! Không thể truy cập Form.</h3>';
  }
}, err => {
  document.getElementById('result').innerHTML = 'Không lấy được vị trí! Vui lòng bật GPS.';
});
</script>
</body>
</html>